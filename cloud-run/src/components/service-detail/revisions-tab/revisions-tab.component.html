<div class="flex h-full">
  <!-- Left Pane: Revisions List -->
  <div class="w-1/2 border-r border-gray-200 flex flex-col">
    <div class="p-4 border-b border-gray-200 shrink-0">
      <div class="flex items-center justify-between">
        <h2 class="text-base font-medium">Revisions</h2>
        <button class="flex items-center space-x-1 px-3 py-1.5 bg-white border border-gray-300 rounded-md text-blue-600 hover:bg-blue-50 text-sm font-medium">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-4.991-2.696V7.75a8.25 8.25 0 0 0-11.667 0v1.193" /></svg>
          <span>Manage traffic</span>
        </button>
      </div>
      <div class="mt-4 p-2 border rounded-md flex items-center">
          <svg class="w-5 h-5 text-gray-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.572a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" /></svg>
        <input type="text" placeholder="Filter revisions" class="text-sm focus:outline-none flex-grow" [value]="revisionFilterTerm()" (input)="onRevisionFilterChange($event)">
      </div>
    </div>
    <div class="overflow-y-auto">
      <table class="w-full text-left text-sm">
        <thead class="bg-gray-50 sticky top-0">
          <tr class="border-b">
            <th class="p-3 w-10"><svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><circle cx="8" cy="8" r="8"/></svg></th>
            <th class="p-3 font-medium text-gray-600 cursor-pointer" (click)="sortByRevision('name')">Name</th>
            <th class="p-3 font-medium text-gray-600">Traffic</th>
            <th class="p-3 font-medium text-gray-600 cursor-pointer" (click)="sortByRevision('deployed')">
              <div class="flex items-center">Deployed @if (revisionSortColumn() === 'deployed') {<span>{{ revisionSortDirection() === 'asc' ? '↑' : '↓' }}</span>}</div>
            </th>
            <th class="p-3 font-medium text-gray-600">Revision tags</th>
            <th class="p-3 font-medium text-gray-600">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (revision of filteredAndSortedRevisions(); track revision.name) {
            <tr class="border-b last:border-b-0 hover:bg-gray-100 cursor-pointer" 
                [class.bg-blue-50]="selectedRevision()?.name === revision.name"
                (click)="selectRevision(revision)">
              <td class="p-3">
                <div class="w-4 h-4 border-2 rounded-full flex items-center justify-center" [class.border-blue-600]="selectedRevision()?.name === revision.name" [class.border-gray-400]="selectedRevision()?.name !== revision.name">
                  @if(selectedRevision()?.name === revision.name) {
                    <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                  }
                </div>
              </td>
              <td class="p-3">
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2" [class.text-green-500]="revision.status === 'active'" [class.text-gray-400]="revision.status === 'inactive'" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                  <span class="font-medium text-gray-800">{{ revision.name }}</span>
                </div>
              </td>
              <td class="p-3 text-gray-800">{{ revision.traffic }}%</td>
              <td class="p-3 text-gray-800">{{ revision.deployed }}</td>
              <td class="p-3 text-gray-800">
                @if (revision.revisionTags.label) {
                  <div class="flex items-center space-x-1">
                    <a [href]="revision.revisionTags.url" class="text-blue-600 hover:underline">{{ revision.revisionTags.label }}</a>
                    @if(revision.revisionTags.editable) {
                      <button class="p-1 rounded-full hover:bg-gray-200">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Z" /></svg>
                      </button>
                    }
                  </div>
                }
              </td>
              <td class="p-3">
                <button class="p-1 rounded-full hover:bg-gray-200">
                  <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  <!-- Right Pane: Revision Details -->
  <div class="w-1/2 flex-grow overflow-y-auto">
    @if (selectedRevision(); as revision) {
      <div class="p-6 bg-white h-full">
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
          <h2 class="text-lg font-medium">{{ revision.name }}</h2>
        </div>
        <p class="text-xs text-gray-500 mt-1 ml-7">Deployed by {{ revision.deployedBy }} using Cloud Console</p>
        
        <div class="border-b mt-4">
          <nav class="-mb-px flex space-x-4" aria-label="Tabs">
            @for(tab of revisionDetailTabs; track tab.id) {
              <button (click)="setActiveRevisionDetailTab(tab.id)"
                class="py-2 px-1 border-b-2 font-medium text-sm"
                [class.border-blue-500]="activeRevisionDetailTab() === tab.id"
                [class.text-blue-600]="activeRevisionDetailTab() === tab.id"
                [class.border-transparent]="activeRevisionDetailTab() !== tab.id"
                [class.text-gray-500]="activeRevisionDetailTab() !== tab.id">
                {{ tab.label }}
              </button>
            }
          </nav>
        </div>

        <div class="mt-6">
          @switch (activeRevisionDetailTab()) {
            @case ('containers') {
              <div class="space-y-6 text-sm">
                <!-- General -->
                <div>
                  <h3 class="font-medium mb-2 text-base">General</h3>
                  <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="text-gray-500">Billing</div><div class="text-gray-800">{{ revision.billing }}</div>
                    <div class="text-gray-500">Startup CPU boost</div><div class="text-gray-800">{{ revision.cpuBoost ? 'Enabled' : 'Disabled' }}</div>
                    <div class="text-gray-500">Concurrency</div><div class="text-gray-800">{{ revision.concurrency }}</div>
                    <div class="text-gray-500">Request timeout</div><div class="text-gray-800">{{ revision.timeout }} seconds</div>
                    <div class="text-gray-500">Execution environment</div><div class="text-gray-800">{{ revision.environment }}</div>
                  </div>
                </div>
                <!-- Autoscaling -->
                <div>
                  <h3 class="font-medium mb-2 text-base">Autoscaling</h3>
                  <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="text-gray-500">Revision max instances</div><div class="text-gray-800">{{ revision.maxInstances }}</div>
                  </div>
                </div>
                <!-- Image -->
                <div>
                  <h3 class="font-medium mb-2 text-base">Image</h3>
                    <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="text-gray-500">Image</div>
                    <div class="flex items-center space-x-2">
                      <a href="#" class="text-blue-600 hover:underline truncate">{{ revision.image }}</a>
                      <button class="p-1 rounded-full hover:bg-gray-200"><svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.5A1.125 1.125 0 0 1 4.875 6.375H8.25M9 9.75a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3v-6Z" /></svg></button>
                    </div>
                    <div class="text-gray-500">Base image</div>
                    <div class="flex items-center space-x-2">
                      <a href="#" class="text-blue-600 hover:underline truncate">{{ revision.baseImage }}</a>
                      <button class="p-1 rounded-full hover:bg-gray-200"><svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.5A1.125 1.125 0 0 1 4.875 6.375H8.25M9 9.75a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3v-6Z" /></svg></button>
                    </div>
                    <div class="text-gray-500">Base image update</div><div class="text-gray-800">{{ revision.baseImageUpdate }}</div>
                    <div class="text-gray-500">Port</div><div class="text-gray-800">{{ revision.port }}</div>
                    <div class="text-gray-500">Build</div><div class="text-gray-800 flex items-center">{{ revision.buildInfo }} <svg class="w-4 h-4 text-gray-500 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg></div>
                    <div class="text-gray-500">Source</div><div class="text-gray-800 flex items-center">{{ revision.sourceInfo }} <svg class="w-4 h-4 text-gray-500 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg></div>
                    <div class="text-gray-500">Command and args</div><div class="text-gray-800">{{ revision.command }}</div>
                    <div class="text-gray-500">CPU limit</div><div class="text-gray-800">{{ revision.cpuLimit }}</div>
                    <div class="text-gray-500">Memory limit</div><div class="text-gray-800">{{ revision.memoryLimit }}</div>
                  </div>
                </div>
                <!-- Environment variables -->
                <div>
                  <button (click)="showEnvVars.set(!showEnvVars())" class="font-medium text-base w-full text-left flex items-center">
                    Environment variables ({{ revision.envVars.length }})
                    <svg class="w-5 h-5 ml-1 transition-transform" [class.rotate-180]="showEnvVars()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                  </button>
                  @if(showEnvVars()) {
                    <div class="mt-2 border rounded-md">
                      <table class="w-full">
                        <thead class="bg-gray-50">
                          <tr class="border-b">
                            <th class="p-2 text-left font-medium text-gray-600">Name</th>
                            <th class="p-2 text-left font-medium text-gray-600">Value</th>
                          </tr>
                        </thead>
                        <tbody>
                          @for (env of revision.envVars; track env.name) {
                            <tr class="border-b last:border-0">
                              <td class="p-2">{{ env.name }}</td>
                              <td class="p-2">{{ env.value }}</td>
                            </tr>
                          }
                        </tbody>
                      </table>
                    </div>
                  }
                </div>
              </div>
            }
            @case ('volumes') {
              <div class="space-y-6 text-sm">
                <div>
                  <h4 class="font-medium text-gray-800">In-memory</h4>
                  <p class="text-gray-600 mt-1">None</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">Secret</h4>
                  <p class="text-gray-600 mt-1">None</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">Network File System</h4>
                  <p class="text-gray-600 mt-1">None</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">Cloud Storage bucket</h4>
                  <p class="text-gray-600 mt-1">None</p>
                </div>
              </div>
            }
            @case ('networking') {
              <div class="space-y-6 text-sm">
                <div>
                  <h4 class="font-medium text-gray-800">VPC</h4>
                  <p class="text-gray-600 mt-1">Network: None</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">HTTP/2</h4>
                  <p class="text-gray-600 mt-1">Disabled</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">Session Affinity</h4>
                  <p class="text-gray-600 mt-1">Disabled</p>
                </div>
                <div>
                  <h4 class="font-medium text-gray-800">Service Mesh</h4>
                  <p class="text-gray-600 mt-1">None</p>
                </div>
              </div>
            }
            @case ('security') { <div>Security details go here.</div> }
            @case ('yaml') { <div>YAML for the revision goes here.</div> }
          }
        </div>
      </div>
    } @else {
      <div class="p-6 text-center text-gray-500 h-full flex items-center justify-center">Select a revision to see its details.</div>
    }
  </div>
</div>