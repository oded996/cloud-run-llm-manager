<div class="flex flex-col h-screen">
  <app-header></app-header>
  <div class="flex flex-1 overflow-hidden">
    <app-sidebar 
      [activeView]="activeView()" 
      [isCollapsed]="isSidebarCollapsed()"
      (viewChange)="onViewChange($event)" 
      (releaseNotesClicked)="displayReleaseNotes()"
      (toggleCollapse)="toggleSidebarCollapse()"></app-sidebar>
    <div class="flex-1 flex flex-col">
      <!-- Sub-header for the main content -->
      <div class="bg-white border-b border-gray-200 h-12 flex items-center justify-between px-6 shrink-0">
        @if (selectedJob(); as job) {
          <div class="flex items-center space-x-2">
            <button (click)="hideJobDetails()" class="p-1 rounded-full hover:bg-gray-100">
              <svg class="w-6 h-6 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
            </button>
            <h1 class="text-xl text-gray-800">Job details</h1>
            <div class="h-6 border-l border-gray-300 mx-2"></div>
            <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" /></svg>
              <span>Execute</span>
            </button>
            <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z" /><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z" /></svg>
              <span>View & edit job configuration</span>
            </button>
             <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
              <span>Delete</span>
            </button>
          </div>
          <div class="flex items-center space-x-2">
             <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                Learn
            </button>
            <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-4.991-2.696V7.75a8.25 8.25 0 0 0-11.667 0v1.193" /></svg>
              Refresh
            </button>
          </div>
        } @else if (selectedService(); as service) {
          <div class="flex items-center space-x-2">
            <button (click)="hideServiceDetails()" class="p-1 rounded-full hover:bg-gray-100">
              <svg class="w-6 h-6 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
            </button>
            <h1 class="text-xl text-gray-800">Service details</h1>
            <div class="h-6 border-l border-gray-300 mx-2"></div>
            <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>
              <span>Edit & deploy new revision</span>
            </button>
            <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
              <span>Edit repo settings</span>
            </button>
            <button class="flex items-center space-x-2 text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" /></svg>
              <span>Test</span>
            </button>
          </div>
          <div class="flex items-center space-x-2">
            <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                Learn
            </button>
            <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-4.991-2.696V7.75a8.25 8.25 0 0 0-11.667 0v1.193" /></svg>
              Refresh
            </button>
          </div>
        } @else if (showCreateService()) {
          <div class="flex items-center space-x-2">
            <button (click)="hideCreateService()" class="p-1 rounded-full hover:bg-gray-100">
              <svg class="w-6 h-6 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
            </button>
            <h1 class="text-xl text-gray-800">Create service</h1>
          </div>
          <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
            Show command line
          </button>
        } @else {
          <div class="flex items-center space-x-4">
            @switch (activeView()) {
              @case ('overview') {
                <h1 class="text-xl text-gray-800">Overview</h1>
              }
              @case ('services') {
                <h1 class="text-xl text-gray-800">Services</h1>
                <div class="h-6 border-l border-gray-300"></div>
                <div class="flex items-center space-x-2">
                  <button (click)="displayCreateService()" class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                    <span class="bg-blue-600 text-white w-5 h-5 flex items-center justify-center rounded-sm mr-2">
                      <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                    </span>
                    Deploy container
                  </button>
                  <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                    <svg class="w-5 h-5 mr-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
                    Connect repo
                  </button>
                  <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" /></svg>
                    Write a function
                  </button>
                </div>
              }
              @case ('jobs') {
                <h1 class="text-xl text-gray-800">Jobs</h1>
                <div class="h-6 border-l border-gray-300"></div>
                <button (click)="displayCreateService()" class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                  <span class="bg-blue-600 text-white w-5 h-5 flex items-center justify-center rounded-sm mr-2">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                  </span>
                  Deploy container
                </button>
              }
              @case ('worker-pools') {
                <div class="flex items-center space-x-2">
                  <h1 class="text-xl text-gray-800">Worker pools</h1>
                  <span class="bg-gray-200 text-gray-600 text-xs font-semibold px-2 py-0.5 rounded-full">Preview</span>
                </div>
                <div class="h-6 border-l border-gray-300"></div>
                <button (click)="displayCreateService()" class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                  <span class="bg-blue-600 text-white w-5 h-5 flex items-center justify-center rounded-sm mr-2">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                  </span>
                  Deploy container
                </button>
              }
              @case ('domain-mappings') {
                <div class="flex items-center space-x-2">
                  <h1 class="text-xl text-gray-800">Domain mappings</h1>
                  <span class="bg-gray-200 text-gray-600 text-xs font-semibold px-2 py-0.5 rounded-full">Preview</span>
                </div>
                <div class="h-6 border-l border-gray-300"></div>
                <div class="flex items-center space-x-2">
                  <button (click)="displayAddMappingModal()" class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                    <span class="bg-blue-600 text-white w-5 h-5 flex items-center justify-center rounded-sm mr-2">
                      <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                    </span>
                    Add mapping
                  </button>
                  <button class="flex items-center justify-center text-gray-600 font-medium text-sm p-2 rounded hover:bg-gray-100">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                    Delete
                  </button>
                </div>
              }
            }
          </div>
          <div class="flex items-center space-x-2">
            @if(activeView() === 'domain-mappings') {
              <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
                <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                Learn
              </button>
            }
            <button class="flex items-center justify-center text-blue-600 font-medium text-sm p-2 rounded hover:bg-blue-50">
              <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-4.991-2.696V7.75a8.25 8.25 0 0 0-11.667 0v1.193" /></svg>
              Refresh
            </button>
          </div>
        }
      </div>
      <main class="flex-1 overflow-y-auto bg-gray-50">
        @if (selectedJob(); as job) {
          <app-job-detail [job]="job"></app-job-detail>
        } @else if (selectedService(); as service) {
          <app-service-detail [service]="service"></app-service-detail>
        } @else if (showCreateService()) {
          <app-create-service (cancelCreate)="hideCreateService()"></app-create-service>
        } @else {
          @switch (activeView()) {
            @case ('overview') { <app-overview (serviceClicked)="onSelectServiceByName($event)" (jobClicked)="onSelectJobByName($event)"></app-overview> }
            @case ('services') { <app-services-list 
                                  [services]="services()"
                                  (serviceSelected)="onServiceSelected($event)"
                                  (toggleSelect)="handleToggleSelect($event)"
                                  (toggleSelectAll)="handleToggleSelectAll($event)"></app-services-list> }
            @case ('jobs') { <app-jobs 
                                [jobs]="jobs()"
                                (jobSelected)="onJobSelected($event)"
                                (toggleSelect)="handleJobToggleSelect($event)"
                                (toggleSelectAll)="handleJobToggleSelectAll($event)"></app-jobs> }
            @case ('worker-pools') { <app-worker-pools></app-worker-pools> }
            @case ('domain-mappings') { <app-domain-mappings (serviceClicked)="onSelectServiceByName($event)"></app-domain-mappings> }
          }
        }
      </main>
    </div>
  </div>
  @if(showAddMappingModal()) {
    <app-add-mapping-modal [services]="services()" (closeModal)="hideAddMappingModal()"></app-add-mapping-modal>
  }
  @if(showReleaseNotes()) {
    <app-release-notes (close)="hideReleaseNotes()"></app-release-notes>
  }
</div>